@model IEnumerable<NIA_CRM.Models.Member>

@{
    ViewData["Title"] = "Index";
}
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
<!--WIDGETS-->
<div class="content" id="content" role="main" aria-labelledby="dashboard-title">
    
    <div class="d-flex flex-row align-items-center justify-content-between mb-4">
        <h1 id="dashboard-title">Dashboard</h1>
        <button class="btn btn-primary">Customize</button>
    </div>

    <div class="row" role="region" aria-labelledby="dashboard-stats">
        <h2 id="dashboard-stats" class="sr-only">Dashboard Statistics</h2>

        <!-- Card 1 -->
        <div class="col-md-4">
            <div class="card text-light" role="group" aria-labelledby="total-members-title">
                <div class="card-body text-center">
                    <p class="card-title" id="total-members-title" role="heading" aria-level="3">Total Members</p>
                    <p class="card-text" aria-live="polite">@ViewData["MemberCount"]</p>
                </div>
            </div>
        </div>

        <!-- Card 2 -->
        <div class="col-md-4">
            <div class="card text-light" role="group" aria-labelledby="members-copperport-title">
                <div class="card-body text-center">
                    <p class="card-title" id="members-copperport-title" role="heading" aria-level="3">Members in Copperport</p>
                    <p class="card-text" aria-live="polite">@Model.Count(m => m.Addresses.Any(a => a.City == "Copperport"))</p>
                </div>
            </div>
        </div>

        <!-- Card 3 -->
        <div class="col-md-4">
            <div class="card text-light" role="group" aria-labelledby="vip-clients-title">
                <div class="card-body text-center">
                    <p class="card-title" id="vip-clients-title" role="heading" aria-level="3">VIP Clients</p>
                    <p class="card-text" aria-live="polite">@ViewData["VipCount"]</p>
                </div>
            </div>
        </div>
    </div>
</div>



@section Scripts {
    
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script>
        $(document).ready(function () {
            // Initially hide the preview container
            $('#previewContainer').addClass('hidden');

            // Handle row clicks
            $(document).on('click', '.clickable-row', function () {
                var memberId = $(this).data('id'); // Get the Member ID
                if (!memberId) {
                    console.error('No member ID found.');
                    return;
                }

                // AJAX request to fetch member details
                $.ajax({
                    url: '/Home/GetMemberPreview', // Adjust the route as necessary
                    type: 'GET',
                    data: { id: memberId },
                    success: function (result) {
                        $('#previewContainer').html(result).removeClass('hidden').addClass('visible');
                    },
                    error: function () {
                        alert('Error fetching member details.');
                    }
                });
            });

            // Hide the preview container when clicking outside
            $(window).click(function (event) {
                if (!$(event.target).closest('#previewContainer, .clickable-row').length) {
                    $('#previewContainer').removeClass('visible').addClass('hidden');
                }
            });

            // Prevent clicks inside the preview container from propagating
            $('#previewContainer').click(function (event) {
                event.stopPropagation();
            });
        });
    </script>

    <script type="text/javascript">
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
        var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl)
        })
    </script>
}
