@model NIA_CRM.Models.Member

@{
    ViewData["Title"] = "Details";
}
<partial name="_Notification" />

<div class="row align-items-center">
    <!-- Logo (Member Thumbnail or Default Image) -->
    <div class="col-auto">
        @if (Model.MemberLogo?.Content != null)
        {
            string imageBase64 = Convert.ToBase64String(Model.MemberLogo.Content);
            string imageSrc = $"data:{Model.MemberLogo.MimeType};base64,{imageBase64}";
            <img src="@imageSrc" alt="Profile Picture of @Model.MemberName"
                 title="Profile Picture of @Model.MemberName"
                 class="img-fluid rounded" style="height: 70px; width: 70px; object-fit: cover;" />
        }
        else
        {
            <img src="~/images/Unknown_person.jpg"
                 alt="Profile Picture of @Model.MemberName"
                 title="Profile Picture of @Model.MemberName"
                 class="img-fluid rounded" style="height: 70px; width: 70px; object-fit: cover;" />
        }
    </div>

    <!-- Member Name -->
    <div class="col">
        <h1 class="mb-0">@Model.MemberName</h1>
    </div>
</div>

<div>
    <h4>Details</h4>
    <hr />
    @{
        var contacts = Model.MemberContacts?.Select(mc => mc.Contact).ToList();
        var primaryContact = contacts?.FirstOrDefault(c => c.IsVip) ?? contacts?.FirstOrDefault();
        var additionalContacts = contacts?.Where(c => c != primaryContact).ToList();
        var addres = Model?.Addresses?.FirstOrDefault();
    }

    <div class="container">
        <div class="row">
            <!-- Left Card: Detailed Information -->
            <div class="col-md-6">
                <h5 class="card-title">Detailed Information</h5>
                <div class="card card-body bg-light text-black">
                    <div class="row">
                        <!-- Left Column: Address & Membership Type -->
                        <div class="col-md-6">
                            <dl>
                                <dt>Address:</dt>
                                <dd>
                                    @if (Model.Addresses != null && Model.Addresses.Any())
                                    {
                                        @foreach (var address in Model.Addresses)
                                        {
                                            <p>
                                                @address.AddressLine1<br />
                                                @if (!string.IsNullOrEmpty(address.AddressLine2))
                                                {
                                                    @address.AddressLine2
                                                    <br />
                                                }
                                                @address.City, @address.StateProvince, @address.PostalCode<br />
                                            </p>
                                        }
                                    }
                                    else
                                    {
                                        <p>No addresses available.</p>
                                    }
                                </dd>

                                <dt>Membership Type:</dt>
                                <dd>
                                    @if (Model.MemberMembershipTypes != null && Model.MemberMembershipTypes.Any())
                                    {
                                        @foreach (var membership in Model.MemberMembershipTypes)
                                        {
                                            <p>@membership.MembershipType.TypeName</p>
                                        }
                                    }
                                    else
                                    {
                                        <p>No membership type available.</p>
                                    }
                                </dd>

                                <dt>Tag:</dt>
                                <dd>
                                    @if (Model.MemberTags != null && Model.MemberTags.Any())
                                    {
                                        @foreach (var tag in Model.MemberTags)
                                        {
                                            <p>@tag.MTag.MTagName</p>
                                        }
                                    }
                                    else
                                    {
                                        <p>No tag available.</p>
                                    }
                                </dd>
                                <dt>Sector:</dt>
                                <dd>
                                    @if (Model.MemberSectors != null && Model.MemberSectors.Any())
                                    {
                                        @foreach (var sector in Model.MemberSectors)
                                        {
                                            <p>@sector.Sector.SectorName</p>
                                        }
                                    }
                                    else
                                    {
                                        <p>No sector available.</p>
                                    }
                                </dd>
                            </dl>
                        </div>

                        <!-- Right Column: Other Details -->
                        <div class="col-md-6">
                            
                            <dt>NAICS Code:</dt>
                            <dd>
                                @if (Model.IndustryNAICSCodes != null && Model.IndustryNAICSCodes.Any())
                                {
                                    @foreach (var NAIC in Model.IndustryNAICSCodes)
                                    {
                                        <p>@NAIC.NAICSCode.Code</p>
                                    }
                                }
                                else
                                {
                                    <p>No NAICS Code available.</p>
                                }
                            </dd>
                            <dl>
                                <dt>@Html.DisplayNameFor(model => model.JoinDate)</dt>
                                <dd>@Html.DisplayFor(model => model.JoinDate)</dd>

                                <dt>Website:</dt>
                                <dd>@Html.DisplayFor(model => model.WebsiteUrl)</dd>

                                <dt>Size:</dt>
                                <dd>@Html.DisplayFor(model => model.MemberSize)</dd>
                            </dl>
                        </div>
                    </div>
                    <div class="position-bottom-left">
                        <a class="btn btn-secondary me-2" asp-controller="Member" asp-action="Edit" asp-route-id="@Model.ID">Edit General Info</a>
                        <a class="btn btn-secondary me-2" asp-controller="Address" asp-action="Edit" asp-route-id="@addres.Id">Edit Address</a>
                    </div>
                </div>
            </div>


            <!-- Right Card: Primary Contact Information -->
            <div class="col-md-6">
                <h5>Primary Contact Information</h5>
                @if (primaryContact != null)
                {
                    <div class="card card-body bg-light text-black">
                        <div class="row">
                            <!-- Left Column -->
                            <div class="col-md-6">
                                <dl>
                                    <dt>Contact Name:</dt>
                                    <dd>
                                        @primaryContact.Summary
                                        @if (primaryContact.IsVip)
                                        {
                                            <span class="badge bg-warning text-dark ms-2">VIP</span>
                                        }
                                    </dd>

                                    <dt>Title:</dt>
                                    <dd>@primaryContact.Title</dd>

                                    <dt>Department:</dt>
                                    <dd>@primaryContact.Department</dd>
                                </dl>
                            </div>

                            <!-- Right Column -->
                            <div class="col-md-6">
                                <dl>
                                    <dt>Email:</dt>
                                    <dd>@primaryContact.Email</dd>

                                    <dt>Phone:</dt>
                                    <dd>@primaryContact.PhoneFormatted</dd>

                                    @if (!string.IsNullOrEmpty(primaryContact.LinkedInUrl))
                                    {
                                        <dt>LinkedIn:</dt>
                                        <dd><a href="@primaryContact.LinkedInUrl" target="_blank">@primaryContact.LinkedInUrl</a></dd>
                                    }



                                </dl>
                            </div>
                        </div>
                        <div class="position-bottom-left">
                            <button type="button" class="btn btn-light me-2"
                                    data-bs-toggle="modal"
                                    data-bs-target="#addCancellationModal"
                                    data-id="@primaryContact.Id">
                                Archive Contact
                            </button>
                            <a class="btn btn-secondary" asp-controller="Contact" asp-action="Edit" asp-route-id="@primaryContact.Id">Edit</a>
                        </div>
                    </div>
                }
                else
                {
                    <p>No primary contact available.</p>
                }
            </div>

            <!-- Additional Contacts (If any) -->
            @if (additionalContacts != null && additionalContacts.Any())
            {
                <div class="row mt-3">
                    <div class="col-md-12">
                        <h5>Additional Contacts</h5>
                        @foreach (var contact in additionalContacts)
                        {
                            <div class="mb-3">
                                <div class="card card-body bg-white text-black">
                                    <dl class="row">
                                        <div class="col-sm-4">
                                            <dt>Contact Name:</dt>
                                            <dd>@contact.Summary</dd>
                                        </div>
                                        <div class="col-sm-4">
                                            <dt>Title:</dt>
                                            <dd>@contact.Title</dd>
                                        </div>
                                        <div class="col-sm-4">
                                            <dt>Department:</dt>
                                            <dd>@contact.Department</dd>
                                        </div>
                                        <div class="col-sm-4">
                                            <dt>Email:</dt>
                                            <dd>@contact.Email</dd>
                                        </div>
                                        <div class="col-sm-4">
                                            <dt>Phone:</dt>
                                            <dd>@contact.PhoneFormatted</dd>
                                        </div>
                                        @if (!string.IsNullOrEmpty(contact.LinkedInUrl))
                                        {
                                            <div class="col-sm-4">
                                                <dt>LinkedIn:</dt>
                                                <dd><a href="@contact.LinkedInUrl" target="_blank">@contact.LinkedInUrl</a></dd>
                                            </div>
                                        }
                                    </dl>
                                    <div class="position-bottom-left">
                                        <button type="button" class="btn btn-light me-2"
                                                data-bs-toggle="modal"
                                                data-bs-target="#addCancellationModal"
                                                data-id="@contact.Id">
                                            Archive Contact
                                        </button>
                                        <a class="btn btn-secondary" asp-controller="Contact" asp-action="Edit" asp-route-id="@contact.Id">Edit</a>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            }

            <!-- Additional Information Card (How Long Since Joined, Days Left, Notes) -->
            <div class="row mt-3">
                <div class="col-md-12">
                    <h5>Additional Information</h5>
                    <div class="card card-body bg-light text-black">

                        <div class="row">
                            <div class="col-md-4">
                                <dt>How Long Since Joined:</dt>
                                <dd>@Html.DisplayFor(model => model.TimeSinceJoined)</dd>
                            </div>
                            <div class="col-md-4">
                                <dt>Days Left in Subscription:</dt>
                                <dd>3 months 4 days</dd>
                            </div>
                            <div class="col-md-4">
                                <dt>Notes:</dt>
                                <dd>@Html.DisplayFor(model => model.MemberNote)</dd>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
        </div>

        <div class="position-bottom-left">
            <a class="btn btn-dark me-2">Archive</a>
            <a class="btn btn-primary me-2" asp-controller="Contact" asp-action="Create" asp-route-id="@Model.ID">Create New Contact</a>
            <a class="btn btn-primary me-2" asp-controller="Member" asp-action="Edit" asp-route-id="@Model.ID">Edit</a>
            <a class="btn btn-primary me-2" asp-controller="Member" asp-action="Index">Back to Members</a>
        </div>

